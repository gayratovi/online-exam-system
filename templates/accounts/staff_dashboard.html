{% extends "base.html" %}

{% block title %}Staff Dashboard | CSSS{% endblock %}

{% block content %}
  {% include "partials/staff_header.html" %}

  <section class="mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>Your Exams</h2>
      <div>
        <a class="btn btn-primary me-2" href="{% url 'create_exam' %}">âž• Create New Exam</a>
        <a class="btn btn-outline-secondary" href="{% url 'staff_results_overview' %}">ðŸ“Š Results Overview</a>
      </div>
    </div>

    <h5 class="mb-3">
      Module: 
      {% if module %}
        <span class="fw-semibold">{{ module.code }}</span> â€” {{ module.name }}
      {% else %}
        <span class="text-muted">Not assigned</span>
      {% endif %}
    </h5>

    {% if exams %}
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <colgroup>
            <col style="width: 46%"> <!-- Title -->
            <col style="width: 13%"> <!-- Status -->
            <col style="width: 13%"> <!-- Created -->
            <col style="width: 20%"> <!-- Actions -->
          </colgroup>
          <thead class="table-dark">
            <tr>
              <th>Title</th>
              <th>Status</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for exam in exams %}
            <tr>
              <td class="fw-semibold">{{ exam.title }}</td>
              <td>
                {% if not exam.is_active %}
                  <span class="badge status-badge bg-secondary">Inactive</span>
                {% elif exam.is_open_now %}
                  <span class="badge status-badge bg-success">Open now</span>
                {% elif exam.opens_at and exam.opens_at > now %}
                  <span class="badge status-badge bg-secondary">Not yet open</span>
                {% else %}
                  <span class="badge status-badge bg-danger">Closed</span>
                {% endif %}
              </td>
              <td>{{ exam.created_at|date:"M d, Y" }}</td>
              <td>
                <a href="{% url 'staff_exam_results' exam.id %}" class="btn btn-sm btn-outline-primary">Results</a>
                <a href="{% url 'staff_exam_manage' exam.id %}" class="btn btn-sm btn-outline-secondary">Manage</a>
                <a href="{% url 'staff_exam_results_export_csv' exam.id %}" class="btn btn-sm btn-outline-success">Export CSV</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="alert alert-info">No exams yet. Create your first exam using the button above.</div>
    {% endif %}
  </section>
{% endblock %}
