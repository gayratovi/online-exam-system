<!DOCTYPE html>
<html lang="en">
<head>
  <title>CSSS â€“ Staff Dashboard</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 20px; }
    header { display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px; }
    h1 { font-size: 22px; margin: 0; }
    table { border-collapse: collapse; width: 100%; margin-top: 16px; }
    th, td { border: 1px solid #ddd; padding: 8px; vertical-align: top; }
    th { background: #f7f7f7; text-align: left; }
    .pill { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid #ddd; }
    .pill-open   { background:#e8f6ef; color:#0f5132; border-color:#badbcc; }
    .pill-closed { background:#fdecea; color:#842029; border-color:#f5c2c7; }
    .topbar a { margin-right: 10px; text-decoration:none; }
    .btn { padding:6px 12px; border-radius:6px; text-decoration:none; background:#0d6efd; color:#fff; }
    .btn:hover { background:#0b5ed7; }
    .muted { color:#666; }

    /* ðŸ”” Messages styling */
    ul.messages { list-style: none; padding: 0; margin: 0 0 15px 0; }
    ul.messages li { padding: 8px 12px; border-radius: 4px; margin-bottom: 8px; }
    ul.messages li.error { background: #fdecea; color: #842029; border: 1px solid #f5c2c7; }
    ul.messages li.success { background: #e8f6ef; color: #0f5132; border: 1px solid #badbcc; }
    ul.messages li.info { background: #e7f1ff; color: #084298; border: 1px solid #b6d4fe; }
  </style>
</head>
<body>
{% include "partials/staff_header.html" %}

  <section>
    <div class="topbar" style="margin: 12px 0;">
      <a class="btn" href="{% url 'create_exam' %}">âž• Create New Exam</a>
      <a href="{% url 'staff_results_overview' %}">ðŸ“Š Results Overview</a>
    </div>
  </section>

  <section>
    <h3>Exams for {% if module %}{{ module.code }} â€” {{ module.name }}{% else %}â€”{% endif %}</h3>
    {% if exams %}
      <table>
        <thead>
          <tr>
            <th>Title</th>
            <th>Opens â†’ Closes</th>
            <th>Duration</th>
            <th>Status</th>
            <th>Created</th>
            <th>Analytics</th>
          </tr>
        </thead>
        <tbody>
          {% for exam in exams %}
          <tr>
            <td>{{ exam.title }}</td>
            <td>
              {% if exam.opens_at %}{{ exam.opens_at }}{% else %}â€”{% endif %} â†’
              {% if exam.closes_at %}{{ exam.closes_at }}{% else %}â€”{% endif %}
            </td>
            <td>{{ exam.duration_minutes }} min</td>
            <td>
              {% if not exam.is_active %}
                <span class="pill">Inactive</span>
              {% else %}
                {% if exam.is_open_now %}
                  <span class="pill pill-open">Open now</span>
                {% else %}
                  {% if exam.opens_at and exam.opens_at > now %}
                    <span class="pill pill-closed">Not yet open</span>
                  {% else %}
                    <span class="pill pill-closed">Closed</span>
                  {% endif %}
                {% endif %}
              {% endif %}
            </td>
            <td>{{ exam.created_at }}</td>
            <td>
              <a href="{% url 'staff_exam_results' exam.id %}">Results</a> |
              <a href="{% url 'staff_exam_manage' exam.id %}">Manage</a>|
              <a href="{% url 'staff_exam_results_export_csv' exam.id %}">Export CSV</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No exams yet. Create your first exam with the button above.</p>
    {% endif %}
  </section>
</body>
</html>
